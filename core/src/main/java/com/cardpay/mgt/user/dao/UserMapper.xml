<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cardpay.mgt.user.dao.UserMapper">
    <resultMap id="BaseResultMap" type="com.cardpay.mgt.user.model.User">
        <!--
          WARNING - @mbg.generated
        -->
        <result column="ID" jdbcType="DECIMAL" property="id"/>
        <result column="USERNAME" jdbcType="VARCHAR" property="username"/>
        <result column="PASSWORD" jdbcType="VARCHAR" property="password"/>
        <result column="LAST_LOGIN_TIME" jdbcType="TIMESTAMP" property="lastLoginTime"/>
        <result column="EMAIL" jdbcType="VARCHAR" property="email"/>
        <result column="TEL" jdbcType="VARCHAR" property="tel"/>
        <result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="STATUS" jdbcType="DECIMAL" property="status"/>
        <result column="USER_CNAME" jdbcType="VARCHAR" property="userCname"/>
        <result column="SEX" jdbcType="DECIMAL" property="sex"/>
        <result column="CREATE_BY" jdbcType="DECIMAL" property="createBy"/>
        <result column="AGE" jdbcType="DECIMAL" property="age"/>
        <result column="PHONE" jdbcType="VARCHAR" property="phone"/>
        <result column="ID_CARD_NUMBER" jdbcType="VARCHAR" property="idCardNumber"/>
        <result column="EMPLOYEE_NUMBER" jdbcType="VARCHAR" property="employeeNumber"/>
        <result column="MODIFY_BY" jdbcType="DECIMAL" property="modifyBy"/>
        <result column="MODIFY_TIME" jdbcType="TIMESTAMP" property="modifyTime"/>
        <result column="USER_TYPE" jdbcType="DECIMAL" property="userType"/>
    </resultMap>

    <resultMap id="UserAuthorityMap" type="com.cardpay.mgt.user.model.UserAuthority">
        <result column="AUTHORITY_NAME" jdbcType="VARCHAR" property="authorityName"/>
        <result column="RESOUCRE_NAME" jdbcType="VARCHAR" property="resoucreName"/>
        <result column="OPERATION_NAME" jdbcType="VARCHAR" property="operationName"/>
    </resultMap>

    <resultMap id="UserUpdateVoMap" type="com.cardpay.mgt.user.model.vo.UserUpdateVo">
        <result column="ID" jdbcType="DECIMAL" property="id"/>
        <result column="ROLE_ID" jdbcType="DECIMAL" property="roleId"/>
        <result column="ORG_ID" jdbcType="DECIMAL" property="orgId"/>
        <result column="ORG_NAME" jdbcType="VARCHAR" property="orgName"/>
        <result column="USERNAME" jdbcType="VARCHAR" property="username"/>
        <result column="EMAIL" jdbcType="VARCHAR" property="email"/>
        <result column="TEL" jdbcType="VARCHAR" property="tel"/>
        <result column="STATUS" jdbcType="DECIMAL" property="status"/>
        <result column="USER_CNAME" jdbcType="VARCHAR" property="userCname"/>
        <result column="SEX" jdbcType="DECIMAL" property="sex"/>
        <result column="AGE" jdbcType="DECIMAL" property="age"/>
        <result column="PHONE" jdbcType="VARCHAR" property="phone"/>
        <result column="ID_CARD_NUMBER" jdbcType="VARCHAR" property="idCardNumber"/>
        <result column="EMPLOYEE_NUMBER" jdbcType="VARCHAR" property="employeeNumber"/>
        <result column="USER_TYPE" jdbcType="DECIMAL" property="userType"/>
    </resultMap>

    <resultMap id="RoleVoMap" type="com.cardpay.mgt.user.model.vo.RoleVo">
        <result column="ID" jdbcType="DECIMAL" property="id"/>
        <result column="ROLE_NAME" jdbcType="VARCHAR" property="roleName"/>
        <result column="ROLE_NAME_ZH" jdbcType="VARCHAR" property="roleNameZh"/>
        <result column="USER_CNAME" jdbcType="VARCHAR" property="userCname"/>
        <result column="userId" jdbcType="DECIMAL" property="userId"/>
    </resultMap>

    <select id="selectByAuthority" resultType="String">
        SELECT
            TA.AUTHORITY_NAME
        FROM
            T_USER TU,
            T_USER_ROLE TUR,
            T_ROLE TR,
            T_ROLE_AUTHORITY TRA,
            T_AUTHORITY TA
        WHERE
            TU."ID" = #{userId}
        AND TR.ORGANIZATION_ID = #{orgId}
        AND TUR.USER_ID = TU."ID"
        AND TUR.ROLE_ID = TR."ID"
        AND TRA.ROLE_ID = TR."ID"
        AND TA."ID" = TRA.AUTHORITY_ID
        AND TR.ROLE_STATUS = 1
        AND TA.AUTHORITY_STATUS = 1
     </select>

    <select id="userPageList" resultMap="BaseResultMap">
        SELECT * FROM T_USER TU
        <if test="orgId != null">
            ,T_USER_ORGANIZATION TUO
        </if>
        WHERE 1=1
        <if test="username !=null">
            AND
            TU.USERNAME=#{username,jdbcType=VARCHAR}
        </if>
        <if test="idCardNumber !=null">
            AND
            TU.ID_CARD_NUMBER=#{idCardNumber,jdbcType=VARCHAR}
        </if>
        AND
        TU.ID=TUO.USER_ID
        AND
        TUO.ORGANIZATION_ID=#{orgId,jdbcType=VARCHAR}
    </select>

    <select id="selectUserUpdateVo" resultMap="UserUpdateVoMap">
        SELECT
            TU."ID",
            TUR.ROLE_ID AS ROLE_ID,
            "TO"."ID" AS ORG_ID,
            "TO".ORG_NAME AS ORG_NAME,
            TU.USERNAME,
            TU.EMAIL,
            TU.TEL,
            TU.STATUS,
            TU.USER_CNAME,
            TU.SEX,
            TU.AGE,
            TU.PHONE,
            TU.ID_CARD_NUMBER,
            TU.EMPLOYEE_NUMBER,
            TU.USER_TYPE
        FROM
            T_USER TU,
            T_USER_ROLE TUR,
            T_ORGANIZATION "TO",
            T_USER_ORGANIZATION TUO
        WHERE
            TU."ID" = #{userId,jdbcType=DECIMAL}
        AND TUR.USER_ID = TU."ID"
        AND TUO.USER_ID = TU."ID"
        AND TUO.ORGANIZATION_ID = "TO"."ID"
    </select>

    <!--按机构查询某个所属角色的用户信息-->
    <select id="queryRoleByOrg" resultMap="RoleVoMap">
            SELECT usr.id AS userId,usr.USER_CNAME , role.*
            FROM
            T_USER usr,
            T_USER_ROLE urole,
            T_ROLE role
            WHERE
            usr."ID" = urole.USER_ID
            AND urole.ROLE_ID = role."ID"
            AND role.ORGANIZATION_ID = #{orgId}
            AND role.ROLE_TYPE = #{roleType}
    </select>

</mapper>